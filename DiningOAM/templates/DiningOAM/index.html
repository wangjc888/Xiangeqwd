<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    {% load staticfiles %}
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>后台管理页面</title>
<link href="{% static 'DiningOAM/css/style.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'DiningOAM/css/store.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'DiningOAM/css/H-ui.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'DiningOAM/css/H-ui.admin.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'DiningOAM/css/Hui-iconfont/1.0.1/iconfont.css' %}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
<script type="text/javascript" src="{% static 'DiningOAM/lib/jquery/1.9.1/jquery.min.js' %}"></script>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=bd87735685cc1e701ca941163efef17a&plugin=AMap.Autocomplete"></script>
<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
{#<script type="text/javascript" src="{% static 'DiningOAM/lib/jquery/1.9.1/jquery.min.js' %}"></script>#}
<script type="text/javascript" src="{% static 'DiningOAM/lib/layer/1.9.3/layer.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningOAM/lib/My97DatePicker/WdatePicker.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningOAM/lib/datatables/1.10.0/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningOAM/js/H-ui.admin.js' %}"></script>
<script src="{% static 'DiningOAM/js/echarts-map-report.js' %}"></script>
<script type="text/JavaScript">

var $_$=function(id) {
	return document.getElementById(id);
}
function oMshecharts(num){
	var oMshEcharts=$_$('mshli-'+num).getElementsByTagName("div")[1];
	oMshEcharts.style.width="95%";
	console.log('width:'+oMshEcharts.offsetWidth+' num:'+num);
}
var orderCount;
var show_count_info;
var judgeCount;
var recordNum;
var stateSheet;
getUserCount();
getOrderCount();
getJudgeCount();
getStatement();
// 获取cookie
function getCookie(name){
    var strCookie = document.cookie;
    var arrCookie = strCookie.split("; ");

    for(var i = 0;i < arrCookie.length;i++){
        var arr = arrCookie[i].split("=");
        if(arr[0] == name) return (arr[1]);
    }
    return "";
}
////读取cookies w3c example
{#function getCookie(name)#}
{#{#}
{#    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");#}
{# #}
{#    if(arr=document.cookie.match(reg))#}
{# #}
{#        return (arr[2]);#}
{#    else#}
{#        return null;#}
//}

//删除cookies
//del Cookie add by ljz
function delCookie(name)
{
    var exp = new Date();
    exp.setTime(exp.getTime() - 100);
    var cval=getCookie(name);
    if(cval!=null)
        document.cookie= name + "="+cval+";expires="+exp.toGMTString();
    test1 = getCookie('username')

}

function show_menu(num){
	for(var i=0;i<100;i++)
	{
		if($_$('mshli-'+i))
		{
			$_$('mshli-'+i).style.display='none';
			$_$('mshlis-'+i).className='';
		}
	}
	$_$('mshli-'+num).style.display='block';	//触发以后信息块
	if(num==1)
	{
		oMshecharts(num);
        //getUserCount();
        //console.log('show_count_info');
        //console.log('long',show_count_info.length);
		lineo(show_count_info);
	}
	else if(num==2)
	{
		oMshecharts(num);
        //getOrderCount();
		linet(orderCount);
	}
    else if(num==3)
	{
        var index = $(this).index();
        getOrderList(index);
    }
    else if(num==5)
    {
        var index = $(this).index();
{#        houseinfolist#}
        getHouseInfoList(index);
    }
    else if(num==6)
	{
        var index = $(this).index();
        getMealList(index);
    }
    else if(num==7)
	{
        createMeal();
    }
    else if(num == 8)
    {
        var index = $(this).index();
        getJudgeList(index);

    }
	else if(num==9)
	{
        oMshecharts(num);
        getJudgeCount();
		pieo(judgeCount);
	}
    else if(num==10)
    {
        oMshecharts(num);
        getStatement();//获取统计报表
        baro(stateSheet);
        //baro();
    }
    else if(num==11)
    {
        console.log('enter in modifyMealPrice');
        modifyMealPrice();//调价
    }
    else if(num==12)//价格对比
    {
        console.log('enter in comparePrice');
        comparePrice();//比价
    }/**/
	$('mshlis-'+num).className='left02down01_xia_li';	//触发以后TAG样式
}
var temp=0;
function show_menuC(){
	if (temp==0){
		document.getElementById('LeftBox').style.display='none';
	  	document.getElementById('RightBox').style.marginLeft='0';
		document.getElementById('Mobile').style.background='url({% static 'DiningOAM/images/center.gif' %})';
		temp=1;
	}else{
		document.getElementById('RightBox').style.marginLeft='222px';
	   	document.getElementById('LeftBox').style.display='block';
		document.getElementById('Mobile').style.background='url({% static 'DiningOAM/images/center0.gif' %})';
   		temp=0;
	}
}

/**/
window.onload=window.onresize=function(){
{% comment %}
{#	userCount = {#}
{#        'show_date_list': ['2015-12-01', '2015-12-02', '2015-12-03'],#}
{#        'daliy_cnt_list': [12, 32, 48],#}
{#        'total_cnt_list': [12, 44, 92]#}
{#    }#}
{#    lineo(userCount);#}

    //lineo();
    //console.log(typeof show_count_info);
    getUserCount();
    //console.log('win_onload:',show_count_info);
    lineo(show_count_info);
{% endcomment %}
    getAdminName();
    hideMenu();
};

//add by ljz
function createMeal()//创建菜品初始化
{
    //alert('enter createMeal')
    $.post('/DiningOAM/getCreateMeal/', {}, function (data) {
        $('#enterCreateMeal').html(data);
    }, 'html');
}

function comparePrice()//获取所有店面菜品的价格对比
{
    $.post('/DiningOAM/comparePrice/', {}, function (data) {
        $('#mshli-12').html(data);
    }, 'html');
}

function getStatement()//获取统计报表数据
{
    $.getJSON('/DiningOAM/getStatement/', function (ret) {
        //将ret中的值保存在show_count_info中
        stateSheet = ret;
        //alert('getStatement:'+stateSheet)
        console.log('getStatement/sheet', stateSheet);
    });
}

function modifyMealPrice()//修改菜品价格
{
    $.post('/DiningOAM/getMealAndPrice/', {}, function (data) {
        $('#mshli-11').html(data);
    }, 'html');

/*    $.getJSON('/DiningOAM/getMealAndPrice/', function (ret) {
        //将ret中的值保存在show_count_info中
        MealPriceInfo = ret;
        console.log('modifyMealPrice');
        console.log('modifyMealPrice', MealPriceInfo);
    });*/
}



function hideMenu()//对非管理员隐藏部分菜单
{
    var username = getCookie('username');
    var is_super = getCookie('type');
    if(is_super == 1)
    {
        //alert('超级管理员，维持不变')
        return true
    }
    else
    {
        //alert('隐藏新加菜品栏');
        document.getElementById('mshlis-4').style.display="none";
        document.getElementById('mshli-4').style.display="none";
    }
}


function getAdminName()
{
    username = getCookie('username');
    var name = document.getElementById('admin-name');
    name.innerHTML = username;
}

function getJudgeCount()
{
    $.getJSON('/DiningOAM/getJudgeDistribute/', function (ret) {
        //将ret中的值保存在show_count_info中
        judgeCount = ret;
        console.log('getJudgeCount', judgeCount);
    });
}

function getOrderCount()
{
    $.getJSON('/DiningOAM/getOrderCount/', function (ret) {
        //将ret中的值保存在show_count_info中
        orderCount = ret;
        //console.log('getOrderCount');
        //console.log('show_count_info',orderCount);
    });
}

function getUserCount()
{
    $.getJSON('/DiningOAM/getUserAllCountInfo/', function (ret) {
        //将ret中的值保存在show_count_info中
        show_count_info = ret;
        //console.log('getUserCount');
        //console.log('show_count_info',show_count_info);
    });
}
    /*订单请求数据*/
function getOrderList (iNow){
    $.post('/DiningOAM/getOrderList/', {'type': iNow}, function (data) {
{#        $('#orderlist').eq(iNow).html(data);#}
{#        $('#order-caculate').eq(iNow).html(data);#}
        $('#getallorder').eq(iNow).html(data);
{#        var a=getCookie('username');//获取到用户名，然后与select当前项一致#}
{#        var b=getCookie('house_name');#}
{#        alert('a: '+ a + 'b: ' + b);#}
{#        recordNum = showOrderNum('order-name', data);#}
{#        alert('recordNum: '+recordNum);#}
    }, 'html');
}

{#add by ljz#}
{#function showOrderNum(name, _data)#}
{#{#}
{#    alert(name)#}
{#    var r = document.getElementsByName(name);#}
{#    var reg = /<tr[^>]*>[\s\S]*?<\/tr>/gi;//通过正则表达式求出当前数据条数#}
{#    results = _data.match(reg);#}
{#    r.innerHTML = results.length;#}
{#    alert(r.innerHTML);#}
{#    return r.innerHTML;#}
//}

//add by ljz
function getHouseInfoList(iNow)
{
    $.post('/DiningOAM/getHouses/', {'type': iNow}, function (data) {
{#        $('#house-caculate').eq(iNow).html(data);#}
        $('#mshli-5').eq(iNow).html(data);
    }, 'html');

{#    $.post('/DiningOAM/getHouses/', {'type': iNow}, function (data) {#}
{#        $('#house-num').eq(iNow).html(data);#}
{#    }, 'html');#}
}
/*菜品请求数据 这里的house_id设置为1 fortest*/
function getMealList (iNow){
    $.post('/DiningOAM/getMealList/', {'type': iNow}, function (data) {
{#        $('#getAllMeal').eq(iNow).html(data);#}
        $('#mshli-6').eq(iNow).html(data);
    }, 'html');
}

function getJudgeList(iNow)
{
    $.post('/DiningOAM/getAllJudge/', {'type': iNow}, function (data) {
{#        $('#judgelist').eq(iNow).html(data);#}
{#        $('#judge-caculate').eq(iNow).html(data);#}
        $('#getAllJudge').eq(iNow).html(data);
    }, 'html');
}

</script>
</head>


<body>
<div class="header">
	<div class="header03"></div>
	<div class="header01"></div>
	<div class="header02">管理系统</div>
</div>
<div class="left" id="LeftBox">
	<div class="left01">
		<div class="left01_right"></div>
		<div class="left01_left"></div>
		<div class="left01_c" id="admin-name">admin</div>
	</div>
	<div class="left02">
		<div class="left02top">
			<div class="left02top_right"></div>
			<div class="left02top_left"></div>
			<div class="left02top_c">用户统计</div>
		</div>
	    <div class="left02down">
			<div style="padding-left: 19px;" onClick="show_menu(1)" id="mshlis-1">
				<a href="javascript:;">&nbsp用户走势图</a>
			</div>
		</div>
	</div>
	<div class="left02">
		<div class="left02top">
			<div class="left02top_right"></div>
			<div class="left02top_left"></div>
			<div class="left02top_c">订单统计</div>
		</div>
		<div class="left02down">
			<div class="left02down01_xia" id="mshbox-3">
				<ul>
					<li onClick="show_menu(2)" id="mshlis-2"><a href="javascript:;">&nbsp每日订单量</a></li>
					<li onClick="show_menu(3)" id="mshlis-3"><a href="javascript:;">&nbsp订单列表</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="left02">
		<div class="left02top">
			<div class="left02top_right"></div>
			<div class="left02top_left"></div>
			<div class="left02top_c">菜品统计</div>
		</div>
		<div class="left02down">
			<div class="left02down01_xia" id="mshbox-6">
				<ul>
					<li onClick="show_menu(4)" id="mshlis-4"><a href="javascript:;">&nbsp新加店面</a></li>
					<li onClick="show_menu(5)" id="mshlis-5"><a href="javascript:;">&nbsp店面列表</a></li>
                    <li onClick="show_menu(6)" id="mshlis-6"><a href="javascript:;">&nbsp菜品列表</a></li>
					<li onClick="show_menu(7)" id="mshlis-7"><a href="javascript:;">&nbsp新加菜品</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="left02">
		<div class="left02top">
			<div class="left02top_right"></div>
			<div class="left02top_left"></div>
			<div class="left02top_c">评价</div>
		</div>
		<div class="left02down">
			<div class="left02down01_xia" id="mshbox-8">
				<ul>
					<li onClick="show_menu(8)" id="mshlis-8"><a href="javascript:;">&nbsp评价列表</a></li>
					<li onClick="show_menu(9)" id="mshlis-9"><a href="javascript:;">&nbsp评价分布</a></li>
				</ul>
			</div>

		</div>
	</div>
    <div class="left02">
		<div class="left02top">
			<div class="left02top_right"></div>
			<div class="left02top_left"></div>
			<div class="left02top_c">管理员</div>
		</div>
		<div class="left02down">
			<div class="left02down01_xia" id="mshbox-10">
				<ul>
					<li onClick="show_menu(10)" id="mshlis-10"><a href="javascript:;">&nbsp报表信息</a></li>
					<li onClick="show_menu(11)" id="mshlis-11"><a href="javascript:;">&nbsp调价信息</a></li>
                    <li onClick="show_menu(12)" id="mshlis-12"><a href="javascript:;">&nbsp价格对比</a></li>
				</ul>
			</div>

		</div>
	</div>
	<div class="left01">
		<div class="left03_right"></div>
		<div class="left01_left"></div>
{#		<div class="left03_c"  style="cursor:pointer" id="sign-logout"><a href="http://127.0.0.1:8000/DiningOAM/logout/">退出登录</a></div>#}
        <div class="left03_c"  style="cursor:pointer" id="sign-logout"><a id="logout">退出登录</a></div>
	</div>
</div>

<div class="rrcc" id="RightBox">
	<div class="center" id="Mobile" onClick="show_menuC()"></div>
	<div class="right" id="mshli-1">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 用户统计 &gt; <span>用户走势图</span></div>
		<div id="echartsmap-line" class="pt-20"></div>
	</div>
	<div class="right noneBox" id="mshli-2">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 订单总量 &gt; <span>每日订单量</span></div>
		<div id="echartsmap-linet" class="pt-20"></div>
	</div>
	<div class="right noneBox" id="mshli-3">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 订单总量 &gt; <span>订单列表</span></div>
    <!--for test-->
        <div id="getallorder">
            <div class="text-c"> 日期范围：
                <input type="text" onFocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" id="logmin" class="input-text Wdate" style="width:120px;" name="order-logmin">
                -
                <input type="text" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" id="logmax" class="input-text Wdate" style="width:120px;" name="order-logmax">
                <select name='order-house' id = "house_id" style="width:80px;height:30px;font-size:14px;padding-top:0px;">
                    {% for item in house_info%}
                    <option value="{{ item.house_id }}">{{ item.house_name }}</option>
                    {% endfor %}
                </select>
                <button name="" id="orderlist-btn" class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
            </div>
            <div id="order-caculate">
{#            <div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onClick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a></span> <span class="r">共有数据：<strong name="order-num" id="order-num-id">{{ order_count }}</strong> 条</span> </div>#}
            <div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"></span> <span class="r">共有数据：<strong name="order-num" id="order-num-id">{{ order_count }}</strong> 条</span> </div>
            <div class="mt-20" id="order-temp-test">
            <table class="table table-border table-bordered table-bg table-hover table-sort">
                <thead>
                    <tr class="text-c">
{#                        <th width="40"><input name="" type="checkbox" value=""></th>#}
                        <th width="40">订单ID</th>
                        <th width="40">支付ID</th>
                        <th width="40">分店ID</th>
                        <th width="40">用户ID</th>
                        <th width="60">订单总额</th>
                        <th width="100">添加时间</th>
                        <th width="100">支付时间</th>
                        <th width="40">订单状态</th>
                        <th width="60">订单内容</th>
                        <th width="100">确认送达时间</th>
                        <th width="80">操作</th>

                    </tr>
                </thead>
                <tbody id="orderlist">
                {% for orderList in  order_list%}
                    <tr class="text-c">
{#                        <td><input name="" type="checkbox" value=""></td>#}
                        <td>{{ orderList.id }}</td>
                        <td>{{ orderList.prepay_id }}</td>
                        <td>{{ orderList.house_id }}</td>
            {#            <td>{{ orderList.user_id }}</td>#}
                        <td>{{ orderList.openid }}</td>
                        <td>{{ orderList.bill_totalling }}</td>
                        <td>{{ orderList.add_time }}</td>
                        <td>{{ orderList.pay_time }}</td>
                        <td>{{ orderList.bill_state }}</td>
                        <td>{{ orderList.bill_content }}</td>
                        <td>{{ orderList.ensure_send_time }}</td>
            {#                        <td class="td-manage"><a style="text-decoration:none" onClick="picture_stop(this,'10001')" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_edit('图库编辑','picture-add.html','10001')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="order_del(this,orderList.id)" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>#}
                        <td class="td-manage"><a style="text-decoration:none" class="ml-5" onClick="order_edit('{{orderList.id}}')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="order_del('{{orderList.id}}')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            </div>
            </div>

        </div>
	<!--表格结束-->
	
	</div>
	<div class="right noneBox" id="mshli-4">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 菜品统计 &gt; <span>新加店面</span></div>

        <!--申请开店信息--><!--action & method add b-->
{#        <form action="/DiningOAM/addHouse/" name="itemForm" id="itemForm" method="POST">#}
            <div class="store-box">
                <div id="container"></div>
                <div id="myPageTop">
                    <table>
                        <tr>
                            <td>
                                <label>按关键字搜索：</label>
                            </td>
                            <td class="column2">
                                <label>左击获取经纬度：</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" placeholder="请输入关键字进行搜索" id="tipinput">
                            </td>
                            <td class="column2">
                                <input type="text" readonly="true" id="lnglat" name="gps_info">
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="box-store">

{#                   <p>店铺ID&nbsp;&nbsp;&nbsp;#}
{#                       <input type="text" placeholder="请填入您的店铺ID" name="house_id"/>#}
    {#                   </p>#}

                    <p name="name1">店铺名字&nbsp;&nbsp;&nbsp;
                       <input type="text" placeholder="请填入您的店铺名字" name="house_name" id="name-id"/>
                    </p>

                    <p>店铺地址&nbsp;&nbsp;&nbsp;
                       <input type="text" placeholder="请填入您的店铺所在地址" name="address" id="address-id"/>
                    </p>

                    <p>店铺联系电话&nbsp;&nbsp;&nbsp;
                       <input type="text" placeholder="请填入您的店铺联系电话" name="phone" id="phone-id"/>
                    </p>

                    <p>登录账号&nbsp;&nbsp;&nbsp;
                       <input type="text" placeholder="请输入您的登录账号" name="username" id="username-id"/>
                    </p>

                    <p>登录密码&nbsp;&nbsp;&nbsp;
                       <input type="password" placeholder="请输入您的登录密码" name="password1" id="password1-id"/>
                    </p>

                    <p>密码确认&nbsp;&nbsp;&nbsp;
                       <input type="password" placeholder="请再次输入您的登录密码" name="password2" id="password2-id"/>
                    </p>

                    <p>账户类型&nbsp;&nbsp;&nbsp;
                    <select name="adminjudge" id="adminjudge-id">
                        <option value="0">普通管理员</option>
                        <option value="1">超级管理员</option>
                    </select>
                    </p>
{#                       <input type="submit" value="提交" class="store-but" id="btnModify" onclick="createHouse()"/>#}
                    <button type="submit" class="store-but" id="btnModify" onClick="createHouse()"><a href="javascript:;">提交</a></button>
{#                    <div id="addHouse-result"></div><!--作为添加结果的返回值 add by ljz-->#}
               </div>
            </div>
{#        </form>#}
    </div>
    <div class="right noneBox" id="addHouse-result"></div><!--add by ljz-->
	<div class="right noneBox" id="mshli-5">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 菜品统计 &gt; <span>店面列表</span></div>
		<div id="house-caculate">
{#            <div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onClick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> <a class="btn btn-primary radius" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 新加店面</a></span> <span class="r">共有数据：<strong  id="house-num"> {{house_count}}</strong> 条</span> </div>#}
            <div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a class="btn btn-primary radius" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 新加店面</a></span> <span class="r">共有数据：<strong  id="house-num"> {{house_count}}</strong> 条</span> </div>
            <div class="mt-20">
                <table class="table table-border table-bordered table-bg table-hover table-sort">
                    <thead>
                        <tr class="text-c">
        {#					<th width="40"><input name="" type="checkbox" value=""></th>#}
                            <th width="40">分店ID</th>
                            <th width="80">分店名称</th>
                            <th width="80">经度</th>
                            <th width="80">纬度</th>
                            <th width="100">分店地址</th>
                            <th width="100">添加时间</th>
                            <th width="100">联系方式</th>
                            <th width="80">操作</th>
                        </tr>
                    </thead>
                    <tbody id="houseinfolist">
                    {% for houseInfo in house_info_list %}
                        <tr class="text-c">
        {#                    <td><input name="" type="checkbox" value=""></td>#}
                            <td>{{ houseInfo.id }}</td>
                            <td>{{ houseInfo.name }}</td>
                            <td>{{ houseInfo.latitude }}</td>
                            <td>{{ houseInfo.longitude }}</td>
                            <td>{{ houseInfo.location }}</td>
                            <td>{{ houseInfo.add_time }}</td>
                            <td>{{ houseInfo.phone }}</td>
        {#                    <td class="td-manage"><a style="text-decoration:none" onClick="picture_stop(this,'10001')" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_edit('图库编辑','picture-add.html','10001')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_del(this,'10001')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>#}
                            <td class="td-manage"><a style="text-decoration:none" class="ml-5" onClick="house_edit('{{ houseInfo.id }}')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="house_del('{{ houseInfo.id }}')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                        </tr>
        {#                <span>{{  forloop.counter }}</span>#}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
		</div>
	</div>
	<div class="right noneBox" id="mshli-6">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 菜品统计 &gt; <span>菜品列表</span></div>
		<div id="getAllMeal">
             <div class="text-c"> 菜品名称：
            {#			<div class="text-c"> 日期范围：#}
            {#                <input type="text" onFocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" class="input-text Wdate" style="width:120px;" name="logmin" />#}
            {#                -#}
            {#                <input type="text" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" class="input-text Wdate" style="width:120px;" name="logmax" />#}
                <input type="text" name="meal-name" id="meal-key" placeholder=" 请输入" style="width:250px" class="input-text">
                <select name='meallist-house' id = "meal-house_id" style="width:80px;height:30px;font-size:14px;padding-top:0px;">
                    {% for item in house_info%}
                        <option value="{{ item.house_id }}">{{ item.house_name }}</option><!--这里需要动态获取当前的分店名和id，并且动态增加-->
                    {% endfor %}
                </select>
                <button name="" id="meallist-btn" class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
            </div>
            <div id="meal-caculate">
            {#<div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onClick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> <a class="btn btn-primary radius" onClick="picture_add('新加菜品','picture-add.html')" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 新加菜品</a></span> <span class="r">共有数据：<strong>{{ meal_count }}</strong> 条</span> </div>#}
            <div class="box-height cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a class="btn btn-primary radius" onClick="picture_add('新加菜品','picture-add.html')" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 新加菜品</a></span> <span class="r">共有数据：<strong>{{ meal_count }}</strong> 条</span> </div>
                <div class="mt-20">
                <table class="table table-border table-bordered table-bg table-hover table-sort">
                    <thead>
                        <tr class="text-c">
{#                            <th width="40"><input name="" type="checkbox" value=""></th>#}
                            <th width="80">菜品ID</th>
                            <th width="100">分店ID</th>
                            <th width="100">分类ID</th>
                            <th width="60">名称</th>
                            <th>缩略图</th>
                            <th width="100">菜品内容</th>
                            <th width="60">评价数量</th>
                            <th width="60">菜品价格</th>
                            <th width="100">添加时间</th>
                            <th width="80">操作</th>
                        </tr>
                    </thead>
                    <tbody id = "mealist">
                    {% for meal in meal_list %}
                        <tr class="text-c">
{#                            <td><input name="" type="checkbox" value=""></td>#}
{#                          <td>{{ meal.id }}</td><!--修改为meal_id-->#}
                            <td>{{ meal.meal_id }}</td>
                            <td>{{ meal.house_id }}</td>
                            <td>{{ meal.category_id }}</td>
                            <td>{{ meal.name }}</td>
            {#                    <td>{{ meal.avatar_url }}</td>#}
                            <td><img src="{{meal.avatar_url}}" width="100px" height="60"></td>
                            <td>{{ meal.detail_content }}</td>
                            <td>{{ meal.judge_count }}</td>
                            <td>{{ meal.meal_price }}</td>
                            <td>{{ meal.add_time }}</td>
            {#                            暂未实现菜品下架功能，故删除该选项#}
            {#                            <td class="td-manage"><a style="text-decoration:none" onClick="picture_stop(this,'10001')" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_edit('图库编辑','picture-add.html','10001')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_del(this,'10001')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>#}
                            <td class="td-manage"><a style="text-decoration:none" class="ml-5" onClick="meal_edit('{{ meal.id }}', '{{ meal.house_id }}')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="meal_del('{{ meal.id }}')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            </div>
            <div id="del_result"></div>
	</div>
    </div>
	<div class="right noneBox" id="mshli-7">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 菜品统计 &gt; <span>新加菜品</span></div>
		<div>
            <div class="box-kell">
                <form action="/DiningOAM/addMeal/" name="addForm" id="addForm" enctype="multipart/form-data" method="POST"><!--add multipart for uploadPic-->
                <p>菜名&nbsp;&nbsp;&nbsp;
                    <input type="text" placeholder="请填入您的菜品名称" name="name" id="meal_name-id"/>
                </p>
                <p>菜品价格&nbsp;&nbsp;&nbsp;
                    <input type="text" placeholder="请填入您的菜品价格" name="meal_price" id="meal_price-id"/>
                </p>
                <p>菜品内容&nbsp;&nbsp;&nbsp;
                    <input type="text" placeholder="请填入您的菜品内容" name="detail_content" id="content-id"/>
                </p>
                <div id="enterCreateMeal">
                    <p class="branch-box">分店&nbsp;&nbsp;&nbsp;
                        <select name="house_name" id="house_name-id" form="addForm">
                            {% for item in house_list %}
                                <option value="{{ item.house_name }}">{{ item.house_name }}</option>
                            {% endfor %}
                        </select>
                    </p>
                    <p class="fication-box">分类&nbsp;&nbsp;&nbsp;
                        <select name="category_id" id="category_id" form="addForm">
                            {% for item2 in category_list%}
                                <option value="{{ item2.id }}">{{ item2.name }}</option>
                            {% endfor %}
                        </select>
                    </p>
                </div>

                <table  border="0" cellspacing="0" cellpadding="0" class="kell-img" style="width: 150px; height: 180px;;">
                    <tbody>
                        <tr>
                            <td height="101" align="center">
    {#                                 <td height="101" align="center" name="image_src">#}
                                <div id="localImag"><img id="preview" src="" width="150" height="180" style="display: block; width: 150px; height: 180px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="padding-top:10px;"><input type="file" name="picfile" id="doc" style="width:150px;" onchange="javascript:setImagePreview();"></td>
                        </tr>
                    </tbody>
                </table>
{#                <input type="submit" value="提交" class="kell-but" id="addModify" onclick="modifyItem()"/>#}
                <input type="submit" value="提交" class="kell-but" id="addModify"/>
                </form>
                <button class="kell-but" align="center" style="float:left;" id="copyMeal" onclick="copyMealFromBase()"><font color="white"></font>从数据库中导入菜品</button>
{#                <button class="kell-but" align="center" style="float:left;" id="copyMeal" href="http://127.0.0.1:8000/DiningOAM/copyMeal/"><font color="white"><font>从数据库中导入菜品</button>#}
{#                <input type="button" value="从数据库导入菜品" class="kell-but" id="copyMeal" onclick="window.location.href('/DiningOAM/copyMeal/')"/><!--这里在点击butt之后并无法跳转至DiningOAM/copyMeal-->#}
            </div>
            <div id="add_meal_result"></div>
		</div>
	</div>
	<div class="right noneBox" id="mshli-8">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 评价 &gt; <span>评价列表</span></div>
		<div id="getAllJudge">
            <div class="text-c"> 日期范围：
                <input type="text" onFocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" class="input-text Wdate" style="width:120px;" name="judge-logmin">
                -
                <input type="text" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" class="input-text Wdate" style="width:120px;" name="judge-logmax">
{#                <input type="text" name="" id="" placeholder=" 图片名称" style="width:250px" class="input-text">#}
{#                <button name="" id="" class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i> 搜图片</button>#}
                <select name='judge-house' id = "house_id" style="width:80px;height:30px;font-size:14px;padding-top:0px;">
                    <option value="4a1d973f-ebfe-47df-80f8-794d1140bb53">家家</option>
                    <option value="e55ce56e-fcc3-4d55-8da8-73720e569652">苹果</option>
                    <option value="4a1d973f-ebfe-47df-80f8-794d2270bb53">桔子</option>
                </select>
                <button name="" id="judgelist-btn" class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i>搜索</button>
            </div>
            <div id="judge-caculate">
                <div class="box-height cl pd-5 bg-1 bk-gray mt-20">
                    <span class="l">
{#                        <a href="javascript:;" onClick="datadel()" class="btn btn-danger radius">#}
{#                            <i class="Hui-iconfont">&#xe6e2;</i> 批量删除#}
{#                        </a>#}
                        <a class="btn btn-primary radius" href="/DiningOAM/loadJudge/">
                            <i class="Hui-iconfont">&#xe600;</i> 导出评价
                        </a>
                    </span>
                    <span class="r">
                        共有数据：<strong>{{ judge_count }}</strong> 条
                    </span>
                </div>
                <div class="mt-20">
                    <table class="table table-border table-bordered table-bg table-hover table-sort">
                        <thead>
                            <tr class="text-c">
{#                                <th width="40"><input name="" type="checkbox" value=""></th>#}
                                <th width="80">评价ID</th>
                                <th width="100">分店ID</th>
                                <th width="80">订单ID</th>
                                <th width="100">菜品</th>
                                <th width="80">用户ID</th>
                                <th width="100">菜品评价</th>
                                <th width="100">送餐速度评价</th>
                                <th width="100">服务质量评价</th>
                                <th width="150">添加时间</th>
                                <th width="80">操作</th>
                            </tr>
                        </thead>

                        <tbody id = "judgelist">
                        {% for judgeInfo in judge_list %}
                            <tr class="text-c">
{#                                <td><input name="" type="checkbox" value=""></td>#}
                                <td>{{ judgeInfo.id }}</td>
                                <td>{{ judgeInfo.house_id }}</td>
                                <td>{{ judgeInfo.bill_id }}</td>
                                <td>{{ judgeInfo.meal_in_house }}</td>
                                <td>{{ judgeInfo.openid }}</td>
                                <td>{{ judgeInfo.judge_meal }}</td>
                                <td>{{ judgeInfo.judge_speed }}</td>
                                <td>{{ judgeInfo.judge_service }}</td>
                                <td>{{ judgeInfo.add_time }}</td>
{#                                评价列表不应有修改功能，故未实现#}
{#                                <td class="td-manage"><a style="text-decoration:none" onClick="picture_stop(this,'10001')" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_edit('图库编辑','picture-add.html','10001')" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="picture_del(this,'10001')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>#}
                                <td class="td-manage"><a style="text-decoration:none" class="ml-5" onClick="judge_edit()" href="javascript:;" title="编辑"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="judge_del('{{ judgeInfo.id }}')" href="javascript:;" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
		</div>
	</div>
	<div class="right noneBox" id="mshli-9">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 评价 &gt; <span>评价分布</span></div>
		<div id="echartsmap-pie" class="pt-20"></div>
	</div>


<!--管理员-->
	<div class="right noneBox" id="mshli-10">
		<div class="right01">
            <img src="{% static 'DiningOAM/images/04.gif' %}" /> 管理员 &gt; <span>报表信息</span></div>

	    <div id="echartsmap-report" style="width: 500px!important; height: 500px;"></div>
	</div>
	<!--表格结束-->


	<div class="right noneBox" id="mshli-11">
		<div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 管理员 &gt; <span>调价单</span></div>
        <div class="price-box">
            <div>餐品列表
                <select name="" id="">
                    <option value="">这是第一个菜品</option>
                    <option value="">这是第二个菜品</option>
                    <option value="">这是第三个菜品</option>
                    <option value="">这是第四个菜品</option>
                </select>
            </div>
            <div style="padding-left:-100px;">当前价格:<input type="text" value="" disabled="true"/></div>
            <div>更新价格:<input type="text" value="" placeholder="请输入新的菜价"/></div>
            <div class="shop-box clearfix">
                <h5>分店  <i> (请勾选需要修改价格的分店)</i></h5>
                <p><input type="checkbox" name="subBox"/>A店</p>
                <p><input type="checkbox" name="subBox"/> B店</p>
                <p><input type="checkbox" name="subBox"/> C店</p>
                <p><input type="checkbox" name="subBox"/> D店</p>
                <p><input type="checkbox" name="subBox"/> F店</p>
{#                <p id="shop-check"><input type="checkbox" id="checkAll"/>全选</p>#}
            </div>
            <input type="button" value="提交" class="shop-btn"/>
        </div>
	</div>

    <div class="right noneBox" id="mshli-12">
        <div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 管理员 &gt; <span>价格对比</span></div>
        <table border="1" id="comparePrice">
            <thead>
                <tr>
                    <th></th>
                    {% for item in house_list %}
                    <th scope="col">{{ item }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for key in price_list %}
                    <tr>
                        <th scope="row">{{ key.meal_name }}</th>
                        {% for price in key.price %}
                            <td>{{ price }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{#    <div class="right noneBox" id="house-edit"><!--修改店面-->#}
{#        <div class="right01"><img src="{% static 'DiningOAM/images/04.gif' %}" /> 菜品统计 &gt; <span>新加店面</span></div>#}
{#    <!--申请开店信息--><!--action & method add b-->#}
{#        <form action="/DiningOAM/addHouse/" name="itemForm" id="itemForm" method="POST">#}
{#        <div class="store-box">#}
{#            <div id="container"></div>#}
{#            <div id="myPageTop">#}
{#                <table>#}
{#                    <tr>#}
{#                        <td>#}
{#                            <label>按关键字搜索：</label>#}
{#                        </td>#}
{#                        <td class="column2">#}
{#                            <label>{{ houseInfo.gpsInfo }}</label>#}
{#                        </td>#}
{#                    </tr>#}
{#                    <tr>#}
{#                        <td>#}
{#                            <input type="text" placeholder="请输入关键字进行搜索" id="tipinput">#}
{#                        </td>#}
{#                        <td class="column2">#}
{#                            <input type="text" readonly="true" id="lnglat" name="gps_info">#}
{#                        </td>#}
{#                    </tr>#}
{#                </table>#}
{#            </div>#}
{##}
{#            <div class="box-store">#}
{#                <p>店铺ID&nbsp;&nbsp;&nbsp;#}
{#                   <input type="text" placeholder="{{ houseInfo.houseId }}" name="house_id"/>#}
{#                </p>#}
{##}
{#                <p name="name1">店铺名字&nbsp;&nbsp;&nbsp;#}
{#                   <input type="text" placeholder="{{ houseInfo.houseName }}" name="house_name" id="name-id"/>#}
{#                </p>#}
{##}
{#                <p>店铺地址&nbsp;&nbsp;&nbsp;#}
{#                   <input type="text" placeholder="{{ houseInfo.address }}" name="address" id="address-id"/>#}
{#                </p>#}
{##}
{#                <p>店铺联系电话&nbsp;&nbsp;&nbsp;#}
{#                   <input type="text" placeholder="{{ houseInfo.phone }}" name="phone" id="phone-id"/>#}
{#                </p>#}
{##}
{#                <p>登录账号&nbsp;&nbsp;&nbsp;#}
{#                   <input type="text" placeholder="{{ logInfo.username }}" name="username" id="username-id"/>#}
{#                </p>#}
{##}
{#                <p>登录密码&nbsp;&nbsp;&nbsp;#}
{#                   <input type="password" placeholder="{{ logInfo.password }}" name="password1" id="password1-id"/>#}
{#                </p>#}
{#                <p>密码确认&nbsp;&nbsp;&nbsp;#}
{#                   <input type="password" placeholder="{{ logInfo.password }}" name="password2" id="password2-id"/>#}
{#                </p>#}
{##}
{#                <p>账户类型&nbsp;&nbsp;&nbsp;#}
{#                <select name="adminjudge" id="adminjudge-id">#}
{#                    {% for item in adminType %}#}
{#                        <option value="{{ item.value }}">{{ item.type }}</option>#}
{#                    {% endfor %}#}
{#                </select>#}
{#                </p>#}
{#                       <input type="submit" value="提交" class="store-but" id="btnModify" onclick="createHouse()"/>#}
{#                <button type="submit" class="store-but" id="btnModify" onClick="house_edit('{{ houseInfo.houseId }}')"><a href="javascript:;">提交</a></button>#}
{#                    <div id="addHouse-result"></div><!--作为添加结果的返回值 add by ljz-->#}
{#           </div>#}
{#        </div>#}
    {#        </form>#}
{#    </div>#}

</div>
<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
<script src="{% static 'DiningOAM/js/echarts-map-line.js' %}"></script>
<script src="{% static 'DiningOAM/js/echarts-map-linet.js' %}"></script>
<script src="{% static 'DiningOAM/js/echarts-map-bar.js' %}"></script>
<script src="{% static 'DiningOAM/js/echarts-map-pie.js' %}"></script>

<script type="text/javascript">
    var map = new AMap.Map("container", {
        resizeEnable: true
    });
    //为地图注册click事件获取鼠标点击出的经纬度坐标
    var clickEventListener = map.on('click', function(e) {
        document.getElementById("lnglat").value = e.lnglat.getLng() + ',' + e.lnglat.getLat()
    });
    var auto = new AMap.Autocomplete({
        input: "tipinput"
    });
    AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发
    function select(e) {
        if (e.poi && e.poi.location) {
            map.setZoom(15);
            map.setCenter(e.poi.location);
        }
    }
</script>

<script type="text/javascript">
//下面用于图片上传预览功能
function setImagePreview(avalue) {
    var docObj=document.getElementById("doc");

    var imgObjPreview=document.getElementById("preview");
    if(docObj.files && docObj.files[0]) {
        //火狐下，直接设img属性
        imgObjPreview.style.display = 'block';
        imgObjPreview.style.width = '150px';
        imgObjPreview.style.height = '180px';
        //imgObjPreview.src = docObj.files[0].getAsDataURL();

        //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
        imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
    }else {
        //IE下，使用滤镜
        docObj.select();
        var imgSrc = document.selection.createRange().text;
        var localImagId = document.getElementById("localImag");
        //必须设置初始大小
        localImagId.style.width = "150px";
        localImagId.style.height = "180px";
        //图片异常的捕捉，防止用户修改后缀来伪造图片
        try{
            localImagId.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
            localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
        }
        catch(e) {
            alert("您上传的图片格式不正确，请重新选择!");
            return false;
        }
        imgObjPreview.style.display = 'none';
        document.selection.empty();
    }
    return true;
}


    //全选
    $("#checkAll").click(function() {
                $('input[name="subBox"]').attr("checked",this.checked);
            });
            var $subBox = $("input[name='subBox']");
            $subBox.click(function(){
                $("#checkAll").attr("checked",$subBox.length == $("input[name='subBox']:checked").length ? true : false);
            });
</script>
<script>
    //提交
/*   $('#btnModify').click(function(){
        var oHouseName = document.getElementsByName('house_name').val();
        var oAddress = document.getElementsByName('address').val();
        var oPhone = document.getElementsByName('phone').val();
        var oUsername = document.getElementsByName('username').val();
        var oPassword1 = document.getElementsByName('password1').val();
        var oPassword2 = document.getElementsByName('password2').val();
        var oAdminjudge = document.getElementsByName('adminjudge').val();

        if( oHouseName == '')
        {
            alert('店面名字不能为空');
            return false;
        }else if( oAddress == '')
        {
            alert('店面地址不能为空');
            return false;
        }else if( oPhone == '')
        {
            alert('店铺联系电话不能为空');
            return false;
        }else if(oUsername == '')
        {
            alert('登录用户名不能为空');
            return false;
        }else if(oPassword1 != oPassword2)
        {
            alert('请重输入密码');
            return false;
        }else if(oPassword1 == '' || oPassword2 == '')
        {
            alert('登录密码不能为空');
            return false;
        }else
        {
            $('#itemForm').submit();
        }
    });

    $('#addModify').click(function(){
        var oName = document.getElementsByName('name').val();
        var oMeal = document.getElementsByName('meal_price').val();
        var oDetail = document.getElementsByName('detail_content').val();
        if( oName = ''){
            alert('菜品名称不能为空');
            return false;
        }else if( oMeal = ''){
            alert('菜品价格不能为空');
            return false;
        }else if( oDetail = ''){
            alert('菜品内容不能为空');
            return false;
        }else {
            $('#addForm').submit();
        }
    });*/

    $('#btn-sosuo').click(function(){
        $('#sosuo-fm').submit();
    });

{#    add by ljz#}
{#    $(document).ready(function(){#}
{#        $("house_search").click(function(){#}
{#            $('#sosuo-fm').submit();#}
{#            var min = $("#logmin").val();#}
{#            var max = $("#logmax").val();#}
{#            var index = $(this).index();#}
{#            $.post("/DiningOAM/getHouses/", {'min':min, 'max':max}, function(ret){#}
{#                $.('#houseinfolist').eq(index).html(ret);#}
{#                console.log('house_search:', ret);#}
{#            })#}
{#        });#}
{#    });#}



    // 修改

{#    var TimerBtn = $('#list-btn');#}
{#    var _data = {};#}
{##}
{#    TimerBtn.click(function(){#}
{#        var a = $('input[name="logmin"]').val();#}
{#        var b = $('input[name="logmax"]').val();#}
{#        _data = {#}
{#            min:a,#}
{#            max:b#}
{#        };#}
{#        gethouses();#}
{#    });#}
{##}
{#    function gethouses (){#}
{#        $.post('/DiningOAM/getMealList/',_data, function (data) {#}
{#            $('#mealist').html(data);#}
{#        }, 'html')#}
{#    }#}

    //add by ljz
{#    $('#house-num').bi#}

    /*
    *   b = document.getElementById('name-id').innerText;//无效获取input值
    *   c = document.getElementById("name-id").value;//能够获取
    *   d = document.getElementById("name-id").val();//无法获取
    *   a = document.getElementsByName('name').value;//无法获取,显示为undefind
    */
    function copyMealFromBase(){
        _data = {
            flag: '1'
        };

        $.post('/DiningOAM/copyMeal/', _data, function(data) {
            $('#copyMeal').html(data);
            console.log('data:', data);
            alert('copyMealFromBase: ');
            data['result'] == 'success' ? alert('创建成功'):alert('创建失败'+data['atach_info']);
        }, 'json');
    }
    $('#addModify').click(function(){
        alert('enter addModify');
        var oName = document.getElementById('meal_name-id').value;
        var oMealPrice = document.getElementById('meal_price-id').value;
        var oDetail = document.getElementById('content-id').value;
        var oHouseName = document.getElementById('house_name-id').value;
        var oCategoryId = document.getElementById('category_id').value;
        var oImage = document.getElementById('doc').value;
        //var preImage = document.getElementById('preview').value;//for test
        //alert('preImage: '+preImage);
        alert('Image: '+oImage+';type:'+typeof(oImage));
        if( oName == ''){
            alert('菜品名称不能为空');
            return false;
        }else if( oMealPrice == ''){
            alert('菜品价格不能为空');
            return false;
        }else if( oDetail == ''){
            alert('菜品内容不能为空');
            return false;
        }else if(oImage == '')
        {
            alert('菜品图片不能为空');
            return false;
        }
        else{
            $('#addForm').submit();
            //window.open("prewAddInfo.html", "", "width=200, height=200");
            /*
            _data = {
                name:oName,
                meal_price:oMealPrice,
                avatar_url:oImage,
                picture:oImage,//add by test loadpic
                detail_content: oDetail,
                category_id:oCategoryId,
                house_name:oHouseName
            };
            $.post('/DiningOAM/addMeal/', _data, function(data) {
                $('#add_meal_result').html(data);
                console.log('data:', data);
                //alert('data: '+data['result']);
                data['result'] == 'success' ? alert('创建成功'):alert('创建失败'+data['atach_info']);
            }, 'json');
            resetMealTable();*/
        }
    });

    function createHouse()
    {
        var create_result;
        var gpsInfo = document.getElementById('lnglat').value;
        var oHouseName = document.getElementById('name-id').value;
        var oAddress = document.getElementById('address-id').value;
        var oPhone = document.getElementById('phone-id').value;
        var oUsername = document.getElementById('username-id').value;
        var oPassword1 = document.getElementById('password1-id').value;
        var oPassword2 = document.getElementById('password2-id').value;
        var oAdminjudge = document.getElementById('adminjudge-id').value;
        /*console.log('gps: ',gpsInfo, 'house_name: ',oHouseName, 'address: ',oAddress, 'phone: ', oPhone,
                'username: ',oUsername, 'password1: ',oPassword1, 'password2: ', oPassword2 ,'adminjudge: ',oAdminjudge);*/
        if(gpsInfo == '')
        {
            alert('请在地图中左击获取店面经纬度');
            return false;
        }
        else if( oHouseName == '')
        {
            alert('店面名字不能为空');
            return false;
        }else if( oAddress == '')
        {
            alert('店面地址不能为空');
            return false;
        }else if( oPhone == '')
        {
            alert('店铺联系电话不能为空');
            return false;
        }else if(oUsername == '')
        {
            alert('登录用户名不能为空');
            return false;
        }else if(oPassword1 != oPassword2)
        {
            alert('请重输入密码');
            return false;
        }else if(oPassword1 == '' || oPassword2 == '')
        {
            alert('登录密码不能为空');
            return false;
        }else
        {
/**/        _data = {
                gps_info : gpsInfo,
                house_name : oHouseName,
                address : oAddress,
                phone : oPhone,
                username : oUsername,//for create log Account
                password1 : oPassword1,
                password2 : oPassword2,
                adminjudge : oAdminjudge
            };
            $.post('/DiningOAM/addHouse/', _data, function(data) {
                $('#addHouse-result').html(data);
                console.log('data:', data);
                //alert('data: '+data['result']);
                data['result'] == 'success' ? alert('创建成功'):alert('创建失败'+data['atach_info']);
            }, 'json');
            resetHouseTable();

        }
    }
    function resetMealTable()
    {
        document.getElementById('meal_name-id').value = null;
        document.getElementById('meal_price-id').value = null;
        document.getElementById('content-id').value=null;
        document.getElementById('house_name-id').value=null;
        document.getElementById('category_id').value=null;
        document.getElementById('doc').value=null;
        document.getElementById('preview').style.display = 'none';
        //document.getElementById('preview').value=null;
    }
    function resetHouseTable()
    {
        document.getElementById('lnglat').value=null;
        document.getElementById('name-id').value=null;
        document.getElementById('address-id').value=null;
        document.getElementById('phone-id').value=null;
        document.getElementById('username-id').value=null;
        document.getElementById('password1-id').value=null;
        document.getElementById('password2-id').value=null;
        document.getElementById('adminjudge-id').value=0;
    }
    function judge_edit()
    {
        is_super = getCookie('type');
        alert('is_super: '+is_super+'; type: '+ typeof (is_super));
        if(is_super == 1)
        {
            alert("可以评价信息");
        }
        else
        {
            alert("您无权修改该评价信息");
        }
    }

    function judge_del(id)
    {
        is_super = getCookie('type');
        alert('is_super: '+is_super);
        if(is_super == 1)
        {
            if (confirm("您确定要删除该评价信息吗？"))
            {
                house_id = $('select[name="judge-house"]').val();//这里能否成功获取当前查询的店面id？
                _data = {
                    id:id,
                    house_id:house_id
                }
                $.post('/DiningOAM/delJudge/', _data, function (data) {
                    $('#judge-caculate').html(data);
                }, 'html');
            }
            else
            {
                return false;
            }
        }
        else
        {
            alert("您无权修改该评价信息");
            return false
        }
    }
    function meal_edit_save(meal_id, house_id)
    {
        alert('保存当前修改的菜品信息');

        var meal_name = document.getElementById('meal_name-edit').value;
        var meal_price = document.getElementById('meal_price-edit').value;
        var meal_content = document.getElementById('content-edit').value;
        var house_name = document.getElementById('house_name-edit').value;
        var meal_category = document.getElementById('category_id-edit').value;
        var meal_image = document.getElementById('doc').value;//图片相关
        alert('meal_image: '+meal_image+'; type:'+typeof (meal_image));
        alert('house_name: '+house_name);
        /**/
        console.log('name: ',meal_name, 'house_name: ',house_name, 'price: ',meal_price, 'content: ', meal_content,
                'category: ',meal_category);
        if(meal_name == '')
        {
            alert('菜品名不能为空，请返回修改');
            return false;
        }
        else if( meal_price == '')
        {
            alert('菜品价格不能为空，请返回修改');
            return false;
        }else if( meal_content == '')
        {
            alert('菜品详情不能为空，请返回修改');
            return false;
        }else if( house_name == '')
        {
            alert('店面名称不能为空，请返回修改');
            return false;
        }else if(meal_category == '')
        {
            alert('菜品类别不能为空，请返回修改');
            return false;
        }
        else
        {
            if(meal_image == '')
            {
                alert('当前菜品图片不用更新');//如果meal_image表示当前菜品图片不用更新
            }
            $('#house_name-edit').removeAttr("disabled");
            $('#addForm').submit();
{#            alert('重定向到菜品列表页面');#}
{#            $.post('/DiningOAM/getMealList/', {}, function (data) {#}
{#                $('#mshli-6').html(data);#}
{#            }, 'html');#}
/*       _data = {
                meal_id : meal_id,
                meal_name:meal_name,
                meal_content:meal_content,
                meal_price:meal_price,
                meal_category:meal_category,
                house_id:house_id,
                house_name:house_name,
                meal_image:meal_image
            };
            $.post('/DiningOAM/updateMeal/', _data, function(data) {
                //$('#mshli-5').html(data);
                console.log('data:', data);
                alert('data: '+data['result']);
                data['result'] == 'success' ? alert('修改成功'):alert('修改失败'+data['atach_info']);
                //var index = $(this).index();
                //getMealList(index);
                $.post('/DiningOAM/getMealList/', {}, function (data) {
                    $('#mshli-6').html(data);
                }, 'html');
            }, 'json');*/

        }
    }

    function meal_edit(meal_id, house_id)
    {
        is_super = getCookie('type');
        alert('is_super: '+is_super+'meal_id: '+meal_id+';house_id'+house_id);
        if(is_super == 1)
        {
            alert("进入菜品修改页面");
            _data = {
                meal_id:meal_id,
                house_id:house_id
            };
            $.post('/DiningOAM/getUpdateMeal/', _data, function(data) {
                $('#mshli-6').html(data);
            }, 'html');
            //进入对应菜单修改页面
        }
        else
        {
            alert("您无权修改菜品信息");
            return false;
        }
    }

    function house_edit_save(house_id){
        alert('保存当前修改的店面信息');
        var gpsInfo = document.getElementById('edit_lnglat').value;
        var oHouseName = document.getElementById('edit_name-id').value;
        var oAddress = document.getElementById('edit_address-id').value;
        var oPhone = document.getElementById('edit_phone-id').value;
        var oUsername = document.getElementById('edit_username-id').value;
        var oPassword1 = document.getElementById('edit_password1-id').value;
        var oPassword2 = document.getElementById('edit_password2-id').value;
        var oAdminjudge = document.getElementById('edit_adminjudge-id').value;
        /**/
        console.log('gps: ',gpsInfo, 'house_name: ',oHouseName, 'address: ',oAddress, 'phone: ', oPhone,
                'username: ',oUsername, 'password1: ',oPassword1, 'password2: ', oPassword2 ,'adminjudge: ',oAdminjudge);

        if(gpsInfo == '')
        {
            alert('请在地图中左击获取店面经纬度');
            return false;
        }
        else if( oHouseName == '')
        {
            alert('店面名字不能为空');
            return false;
        }else if( oAddress == '')
        {
            alert('店面地址不能为空');
            return false;
        }else if( oPhone == '')
        {
            alert('店铺联系电话不能为空');
            return false;
        }else if(oUsername == '')
        {
            alert('登录用户名不能为空');
            return false;
        }else if(oPassword1 != oPassword2)
        {
            alert('请重输入密码');
            return false;
        }else if(oPassword1 == '' || oPassword2 == '')
        {
            alert('登录密码不能为空');
            return false;
        }else
        {
/**/        _data = {
                gps_info : gpsInfo,
                house_name : oHouseName,
                address : oAddress,
                phone : oPhone,
                username : oUsername,//for create log Account
                password1 : oPassword1,
                password2 : oPassword2,
                adminjudge : oAdminjudge,
                house_id: house_id,
                flag: 1//如果是修改则为1，创建为0
            };
            $.post('/DiningOAM/addHouse/', _data, function(data) {
                //$('#mshli-5').html(data);
                console.log('data:', data);
                alert('data: '+data['result']);
                data['result'] == 'success' ? alert('修改成功'):alert('修改失败'+data['atach_info']);
                var index = $(this).index();
                getHouseInfoList(index);
                //window.location = '/DiningOAM/index/';
                //show_menu(5);
            }, 'json');

        }
    }

    function house_edit(id)
    {
        alert("进入店面修改部分：id: "+id);
        _data = {
            house_id:id
        };
        $.post('/DiningOAM/getUpdateHouse/', _data, function (data) {
            $('#mshli-5').html(data);
        }, 'html');
        //如果创建成功，则弹出提示对话框，并重定向到店面列表页面

    }
    function house_del(id)
    {
        is_super = getCookie('type');
        if (is_super == 1)
        {
            if (confirm("您确定要删除该账户吗？"))
            {
                _data = {
                    id:id
                }
                $.post('/DiningOAM/delHouse/', _data, function (data) {
                    $('#house-caculate').html(data);
                }, 'html');
                //console.log('house-caculate:', house-caculate)
            }
            else
            {
                return false;
            }
        }
        else
        {
            alert("您无权删除账户信息")
        }
    }

    function order_edit()
    {
{#        getCookie('username', );#}
        alert('can not edit order_edit');
    }

    function order_del(id)
    {
{#        is_super = getCookie('type');#}
{#        alert('is_super: '+is_super);#}
        if (confirm("您确定要删除该订单记录吗？"))
        {
            house_id = $('select[name="order-house"]').val();//这里能否成功获取当前查询的店面id？
{#            alert('house_id:', house_id)#}
            _data = {
                id:id,
                house_id:house_id
            }
            $.post('/DiningOAM/delOrder/', _data, function (data) {
                //$('#order-caculate').html(data);
                $('#getallorder').html(data);
                data['result'] == 'success' ? alert('删除成功'):alert('删除失败：'+data['atach_info']);
                if(data['result'] == 'success')
                {
                    var index = $(this).index();
                    getOrderList(index);
                }
            }, 'json');

            //$.post('/DiningOAM/delOrder/', _data, function (data) {
{#          //      $('#orderlist').html(data);#}
            //    $('#order-caculate').html(data);
            //}, 'html');//直接返回渲染后的页面
            //console.log('orderlist:', orderlist)
        }
        else
        {
            return false;
        }
    }
    /*
    function order_del(id)
    {
{#        is_super = getCookie('type');#}
{#        alert('is_super: '+is_super);#}
        if (confirm("您确定要删除该订单记录吗？"))
        {
            house_id = $('select[name="order-house"]').val();//这里能否成功获取当前查询的店面id？
{#            alert('house_id:', house_id)#}
            _data = {
                id:id,
                house_id:house_id
            }
            $.post('/DiningOAM/delOrder/', _data, function (data) {
                //$('#order-caculate').html(data);
                $('#getallorder').html(data);
            }, 'html');
            //$.post('/DiningOAM/delOrder/', _data, function (data) {
{#          //      $('#orderlist').html(data);#}
            //    $('#order-caculate').html(data);
            //}, 'html');//直接返回渲染后的页面
            console.log('orderlist:', orderlist)
        }
        else
        {
            return false;
        }
    }*/

    $('#meallist-btn').click(function(){
        var meal_name = $('input[name="meal-name"]').val();
        var id = $('select[name="meallist-house"]').val();
        if (meal_name == '')//如果没有输入查询关键字，则不返回min或max
        {
            _data = {
            house_id:id
            };
        }
        else
        {
            _data = {
            name:meal_name,
            house_id:id
            };
        }
        $.post('/DiningOAM/getMealList/',_data, function (data) {
{#            $('#meal-caculate').html(data);#}
{#            $('#getAllMeal').html(data);#}
            $('#mshli-6').html(data);
        }, 'html');
    });

    $('#judgelist-btn').click(function(){
        var min_time = $('input[name="judge-logmin"]').val();
        var max_time = $('input[name="judge-logmax"]').val();
        var id = $('select[name="judge-house"]').val();
        if (min_time == 0 || max_time == 0)//如果没有输入时间，则不返回min或max
        {
            _data = {
            house_id:id
            };
        }
        else
        {
            _data = {
            min:min_time,
            max:max_time,
            house_id:id
            };
        }
        $.post('/DiningOAM/getAllJudge/',_data, function (data) {
{#            $('#judgelist').html(data);#}
{#            $('#judge-caculate').html(data);#}
            $('#getAllJudge').html(data);
        }, 'html');
    });

{#    function getJudge(){#}
{#        $.post('/DiningOAM/getAllJudge/',_data, function (data) {#}
{#            $('#judgelist').html(data);#}
{#        }, 'html')#}
{#    }#}


    $('#orderlist-btn').click(function(){
        //var min_time = $('input[name="order-logmin"]').val();
        //var max_time = $('input[name="order-logmax"]').val();
        //var id = $('select[name="order-house"]').val();
        alert('enter orderlist-btn');
        var min_time = $('#logmin').val();
        var max_time = $('#logmax').val();
        var id = $('#house_id').val();
        alert('min:'+min_time+';max:'+max_time+';id:'+id)
        console.log('order-house:', id);
        if (min_time == 0 || max_time == 0)//如果没有输入时间，则不返回min或max
        {
            _data = {
            house_id:id
            };
        }
        else
        {
            _data = {
            min:min_time,
            max:max_time,
            house_id:id
            };
        }

        $.post('/DiningOAM/getOrderList/',_data, function (data) {
{#            $('#orderlist').html(data);#}
{#            $('#order-caculate').html(data);#}
            $('#getallorder').html(data);
        }, 'html');
    });


    $('#logout').click(function(){
        if (confirm("您确定要退出登录吗？"))
        {
{#            delCookie('username');#}
{#            delCookie('house_name');//这里并没有成功删除cookie，而是在view.py中的logout()中删除#}
            top.location = "/DiningOAM/login/";
            $.get('/DiningOAM/logout/',{ }, function (data) {
                $('#sign-logout').html(data);
            }, 'html');
        }
        else
        {
            return false;
        }
    });

</script>
<script>
    //原始文档

  //  var TimerBtn = $('#list-btn');
   // var _data = {};

  //  TimerBtn.click(function(){
   //     var a = $('input[name="logmin"]').val();
    //    var b = $('input[name="logmax"]').val();
    //    _data = {
   //         min:a,
   //         max:b
   //     };
   //     gethouses();
  //  })



   // function gethouses (){

   //     $.post('/DiningOAM/getMealList/',_data, function (data) {
   ///         $('#mealist').html(data);
   //     }, 'html')
  //  }
</script>
</body>
</html>