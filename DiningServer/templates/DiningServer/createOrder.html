
<!DOCTYPE html>
<html>
{% load staticfiles %}
<head lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, user-scalable=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>支付页面</title>
<link rel="stylesheet" type="text/css" href="{% static 'DiningServer/css/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'DiningServer/css/orderPay.css' %}">
<script>
  window.onload = function(){
        function to(num){
        return num<10?'0'+num:''+num;
    }
    var Timer=document.getElementById('timer');
    var t=15*60;
    setInterval(function(){
        t--;
        var m=Math.floor(t/60);
        var s=t%60;
        Timer.innerHTML=m+':'+to(s);
        
        if(t==1){
            alert('您已超过支付时间，请您重新提交订单及时支付');
            window.location.href ='/DiningServer/index/';
        }
    },1000);


  }
</script>
</head>

<body>

<div class="box-timer">

    <!--剩余时间-->
    <div class="timer-surplus">
        <a href="javascript:;"></a>
        <a href="javascript:;">支付剩余时间</a>
        <p class="timer-tm" id="timer">
            15:00
        </p>
    </div>
    
    <!--结算信息-->
    <div class="setent">结算信息</div>
    <div class="set-box">
        <p style="font-size:0.1rem;">订单号: {{ bill_id }}</p>
        <p>订单总价: {{ all_fee }}</p>
    </div>

    <!--支付方式-->
    <div class="setent">选择支付方式</div>
    <div class="payment-box">
        <div></div>
        <div>
            <p>微信支付</p>
            <p>推荐安装微信5.0及以上版本的使用</p>
        </div>
        <div></div>
    </div>
    <div class="compayment" id="compayment" onclick="onBridgeReady()">确认支付</div>
</div>



<script type="text/javascript" src="{% static 'DiningServer/js/Adaptive.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningServer/js/jquery-1.7.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningServer/js/jweixin-1.0.0.js' %}"></script>
<script type="text/javascript" src="{% static 'DiningServer/js/fastclick.js' %}"></script>
<script type="text/javascript">


    var json = {};
    var $compayment = $("#compayment")
            , url = '/DiningServer/createOrder/';


    //选好了提交
   $compayment.on ("touchstart", function () {
       onBridgeReady();
   });


    function onBridgeReady(){
       WeixinJSBridge.invoke(
           'getBrandWCPayRequest', {
               "appId" :    "{{appId}}", 
               "timeStamp": "{{timeStamp}}",    
               "nonceStr":  "{{nonceStr}}",    
               "package" :  "{{package}}",     
               "signType":  "{{signType}}",  
               "paySign" :  "{{paySign}}" 
           },
           function(res){    
                if(res.err_msg == "get_brand_wcpay_request:ok"){
                       window.location.href="http://xiangeqwd.9xi.com/DiningServer/getOrder/?bill_id={{bill_id}}";
                }else{
                       alert(支付失败);
                       window.location.href="http://xiangeqwd.9xi.com/DiningServer/getOrder/?bill_id={{bill_id}}";   
                }
           }           
       ); 
    }

    if (typeof WeixinJSBridge == "undefined"){
       if( document.addEventListener ){
           document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
       }else if (document.attachEvent){
           document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
           document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
       }
    }else{
       onBridgeReady();
    } 


</script>
</body>
</html>